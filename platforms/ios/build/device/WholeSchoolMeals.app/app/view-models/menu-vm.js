"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var observable_1 = require("data/observable");
var models_1 = require("../shared/models");
var allergens_vm_1 = require("../view-models/allergens-vm");
var couchbase = require("nativescript-couchbase");
var allergenList = new allergens_vm_1.AllergenList;
var Menu = (function (_super) {
    __extends(Menu, _super);
    function Menu() {
        return _super.call(this) || this;
    }
    Menu.prototype.load = function (date) {
        var _this = this;
        return fetch(models_1.Config.apiUrl + "menu.ashx?d=" + date)
            .then(handleErrors)
            .then(function (response) {
            return response.json();
        }).then(function (data) {
            _this.handleData(data);
            // Add to local db
            var database = new couchbase.Couchbase("wsm");
            var menu = database.getDocument(date);
            if (!menu) {
                database.createDocument(data, date);
            }
            else {
                database.updateDocument(date, data);
            }
        })
            .catch(function (error) {
            _this.checkDatabase(date, error);
        });
    };
    Menu.prototype.checkDatabase = function (date, error) {
        var database = new couchbase.Couchbase("wsm");
        var menu = database.getDocument(date);
        if (!menu) {
            throw Error(error);
        }
        else {
            this.handleData(menu);
        }
    };
    Menu.prototype.handleData = function (data) {
        if (data) {
            this.set("menuDate", data.MenuDate);
            this.set("calendarId", data.CalendarID);
            this.set("main1", this.makeDish(data.Main1, data.CalendarID, data.MenuDate, "no_image_broccoli.jpg"));
            this.set("main2", this.makeDish(data.Main2, data.CalendarID, data.MenuDate, "no_image_leek.jpg"));
            this.set("side1", this.makeDish(data.Side1, data.CalendarID, data.MenuDate, "no_image_carrot.jpg"));
            this.set("side2", this.makeDish(data.Side2, data.CalendarID, data.MenuDate, "no_image_pumpkin.jpg"));
            this.set("side3", this.makeDish(data.Side3, data.CalendarID, data.MenuDate, "no_image_broccoli.jpg"));
            this.set("side4", this.makeDish(data.Side4, data.CalendarID, data.MenuDate, "no_image_leek.jpg"));
            this.set("side5", this.makeDish(data.Side5, data.CalendarID, data.MenuDate, "no_image_carrot.jpg"));
            this.set("dessert1", this.makeDish(data.Dessert1, data.CalendarID, data.MenuDate, "no_image_strawberry.jpg"));
            this.set("dessert2", this.makeDish(data.Dessert2, data.CalendarID, data.MenuDate, "no_image_pumpkin.jpg"));
            this.set("dessert3", this.makeDish(data.Dessert3, data.CalendarID, data.MenuDate, "no_image_strawberry.jpg"));
            this.set("dessert4", this.makeDish(data.Dessert4, data.CalendarID, data.MenuDate, "no_image_pumpkin.jpg"));
        }
    };
    Menu.prototype.makeDish = function (jsonObj, calendarId, menuDate, noImgPath) {
        if (jsonObj) {
            // Setup dish object
            var dish_1 = {
                id: jsonObj.DishID,
                calendarId: calendarId,
                menuDate: menuDate,
                name: jsonObj.Name,
                description: jsonObj.Description,
                description_html: "</style><div style=\"font-family: Arial, Helvetica, sans-serif;\">" + jsonObj.DescriptionHTML + "</div>",
                vegetarian: jsonObj.Vegetarian,
                ingredients: [],
                allergens: [],
                hasYourAllergens: false,
                yourAllergenCount: 0,
                yourAllergenMessage: "",
                hasGallery: false,
                photos: []
            };
            // Ingredients
            var ingredientStr_1 = [];
            jsonObj.Ingredients.forEach(function (ingredient) {
                var ing = {
                    id: ingredient.IngredientID,
                    name: ingredient.Ingredient,
                    vegetarian: ingredient.Vegetarian,
                    measurementId: ingredient.MeasurementID,
                    heading: ingredient.Heading,
                    allergens: [],
                };
                var allergensStr = [];
                if (ingredient.Allergens) {
                    ingredient.Allergens.forEach(function (allergen) {
                        if (!allergen.Deleted) {
                            ing.allergens.push({
                                id: allergen.AllergenID,
                                name: allergen.Allergen
                            });
                            allergensStr.push(allergen.Allergen);
                        }
                    });
                }
                if (!ingredient.Heading) {
                    if (allergensStr.length > 0) {
                        ingredientStr_1.push(ingredient.Ingredient + " (" + allergensStr.toString() + ")");
                    }
                    else {
                        ingredientStr_1.push(ingredient.Ingredient);
                    }
                }
                dish_1.ingredients.push(ing);
            });
            dish_1.ingredientList = ingredientStr_1.join(', ');
            // Allergens
            var allergensStr_1 = [];
            var yourAllergensStr_1 = [];
            jsonObj.Allergens.forEach(function (allergen) {
                if (!allergen.Deleted) {
                    dish_1.allergens.push({
                        id: allergen.AllergenID,
                        name: allergen.Allergen
                    });
                    allergensStr_1.push(allergen.Allergen);
                    if (allergenList.myAllergens.includes(allergen.AllergenID)) {
                        yourAllergensStr_1.push(allergen.Allergen);
                    }
                }
            });
            dish_1.allergenList = allergensStr_1.join(', ');
            // Has your allergens?
            if (yourAllergensStr_1.length > 0) {
                dish_1.yourAllergens = yourAllergensStr_1.join(', ');
                dish_1.hasYourAllergens = true;
                dish_1.yourAllergenCount = yourAllergensStr_1.length;
                dish_1.yourAllergenMessage = dish_1.name + " contains " + dish_1.yourAllergenCount + " of your allergens";
            }
            // Photos
            jsonObj.Photos.forEach(function (photo, index) {
                if (index == 0) {
                    dish_1.photo = photo.URL;
                }
                dish_1.photos.push({
                    url: photo.URL,
                    caption: photo.Caption
                });
            });
            if (!dish_1.photo) {
                //dish.photo = "~/images/" + Config.noImagePaths[Math.floor(Math.random() * Config.noImagePaths.length)];
                dish_1.photo = "~/images/" + noImgPath;
            }
            if (dish_1.photos.length > 1) {
                dish_1.hasGallery = true;
            }
            // Return the dish
            return dish_1;
        }
        else {
            return {
                id: 0,
                calendarId: 0,
                menuDate: new Date(),
                name: '',
                description: '',
                description_html: '',
                vegetarian: false,
                hasYourAllergens: false,
                yourAllergenCount: 0,
                yourAllergenMessage: "",
                photo: ""
            };
        }
    };
    return Menu;
}(observable_1.Observable));
exports.Menu = Menu;
function handleErrors(response) {
    if (!response.ok) {
        throw Error(response.status);
    }
    return response;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWVudS12bS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIm1lbnUtdm0udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSw4Q0FBNkM7QUFDN0MsMkNBQXNGO0FBQ3RGLDREQUEyRDtBQUMzRCxrREFBb0Q7QUFFcEQsSUFBSSxZQUFZLEdBQUcsSUFBSSwyQkFBWSxDQUFDO0FBRXBDO0lBQTBCLHdCQUFVO0lBZWhDO2VBQ0ksaUJBQU87SUFDWCxDQUFDO0lBRUQsbUJBQUksR0FBSixVQUFLLElBQUk7UUFBVCxpQkFvQkM7UUFuQkcsTUFBTSxDQUFDLEtBQUssQ0FBQyxlQUFNLENBQUMsTUFBTSxHQUFHLGNBQWMsR0FBRyxJQUFJLENBQUM7YUFDOUMsSUFBSSxDQUFDLFlBQVksQ0FBQzthQUNsQixJQUFJLENBQUMsVUFBQSxRQUFRO1lBQ1YsTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUMzQixDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBQSxJQUFJO1lBQ1IsS0FBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUV0QixrQkFBa0I7WUFDbEIsSUFBSSxRQUFRLEdBQUcsSUFBSSxTQUFTLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQzlDLElBQUksSUFBSSxHQUFHLFFBQVEsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDdEMsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO2dCQUNSLFFBQVEsQ0FBQyxjQUFjLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO1lBQ3hDLENBQUM7WUFBQyxJQUFJLENBQUMsQ0FBQztnQkFDSixRQUFRLENBQUMsY0FBYyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztZQUN4QyxDQUFDO1FBQ0wsQ0FBQyxDQUFDO2FBQ0QsS0FBSyxDQUFDLFVBQUEsS0FBSztZQUNSLEtBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQ3BDLENBQUMsQ0FBQyxDQUFDO0lBQ1gsQ0FBQztJQUVPLDRCQUFhLEdBQXJCLFVBQXNCLElBQVksRUFBRSxLQUFLO1FBQ3JDLElBQUksUUFBUSxHQUF3QixJQUFJLFNBQVMsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDbkUsSUFBSSxJQUFJLEdBQVksUUFBUSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMvQyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7WUFDUixNQUFNLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUN2QixDQUFDO1FBQUMsSUFBSSxDQUFDLENBQUM7WUFDSixJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzFCLENBQUM7SUFDTCxDQUFDO0lBRU8seUJBQVUsR0FBbEIsVUFBbUIsSUFBSTtRQUNuQixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1lBQ1AsSUFBSSxDQUFDLEdBQUcsQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ3BDLElBQUksQ0FBQyxHQUFHLENBQUMsWUFBWSxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUN4QyxJQUFJLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsUUFBUSxFQUFFLHVCQUF1QixDQUFDLENBQUMsQ0FBQztZQUN0RyxJQUFJLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsUUFBUSxFQUFFLG1CQUFtQixDQUFDLENBQUMsQ0FBQztZQUNsRyxJQUFJLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsUUFBUSxFQUFFLHFCQUFxQixDQUFDLENBQUMsQ0FBQztZQUNwRyxJQUFJLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsUUFBUSxFQUFFLHNCQUFzQixDQUFDLENBQUMsQ0FBQztZQUNyRyxJQUFJLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsUUFBUSxFQUFFLHVCQUF1QixDQUFDLENBQUMsQ0FBQztZQUN0RyxJQUFJLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsUUFBUSxFQUFFLG1CQUFtQixDQUFDLENBQUMsQ0FBQztZQUNsRyxJQUFJLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsUUFBUSxFQUFFLHFCQUFxQixDQUFDLENBQUMsQ0FBQztZQUNwRyxJQUFJLENBQUMsR0FBRyxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsUUFBUSxFQUFFLHlCQUF5QixDQUFDLENBQUMsQ0FBQztZQUM5RyxJQUFJLENBQUMsR0FBRyxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsUUFBUSxFQUFFLHNCQUFzQixDQUFD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RTtnQkFDcEIsSUFBSSxFQUFFLEVBQUU7Z0JBQ1IsV0FBVyxFQUFFLEVBQUU7Z0JBQ2YsZ0JBQWdCLEVBQUUsRUFBRTtnQkFDcEIsVUFBVSxFQUFFLEtBQUs7Z0JBQ2pCLGdCQUFnQixFQUFFLEtBQUs7Z0JBQ3ZCLGlCQUFpQixFQUFFLENBQUM7Z0JBQ3BCLG1CQUFtQixFQUFFLEVBQUU7Z0JBQ3ZCLEtBQUssRUFBRSxFQUFFO2FBQ1osQ0FBQztRQUNOLENBQUM7SUFDTCxDQUFDO0lBQ0wsV0FBQztBQUFELENBQUMsQUFoTUQsQ0FBMEIsdUJBQVUsR0FnTW5DO0FBaE1ZLG9CQUFJO0FBa01qQixzQkFBc0IsUUFBUTtJQUMxQixFQUFFLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ2YsTUFBTSxLQUFLLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ2pDLENBQUM7SUFDRCxNQUFNLENBQUMsUUFBUSxDQUFDO0FBQ3BCLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSBcImRhdGEvb2JzZXJ2YWJsZVwiO1xuaW1wb3J0IHsgQ29uZmlnLCBEaXNoLCBJbmdyZWRpZW50LCBBbGxlcmdlbiwgUGhvdG8sIERheU1lbnUgfSBmcm9tIFwiLi4vc2hhcmVkL21vZGVsc1wiO1xuaW1wb3J0IHsgQWxsZXJnZW5MaXN0IH0gZnJvbSAnLi4vdmlldy1tb2RlbHMvYWxsZXJnZW5zLXZtJztcbmltcG9ydCAqIGFzIGNvdWNoYmFzZSBmcm9tIFwibmF0aXZlc2NyaXB0LWNvdWNoYmFzZVwiO1xuXG52YXIgYWxsZXJnZW5MaXN0ID0gbmV3IEFsbGVyZ2VuTGlzdDtcblxuZXhwb3J0IGNsYXNzIE1lbnUgZXh0ZW5kcyBPYnNlcnZhYmxlIGltcGxlbWVudHMgRGF5TWVudSB7XG4gICAgbWVudURhdGU6IERhdGU7XG4gICAgY2FsZW5kYXJJZDogbnVtYmVyO1xuICAgIG1haW4xOiBEaXNoO1xuICAgIG1haW4yOiBEaXNoO1xuICAgIHNpZGUxOiBEaXNoO1xuICAgIHNpZGUyOiBEaXNoO1xuICAgIHNpZGUzOiBEaXNoO1xuICAgIHNpZGU0OiBEaXNoO1xuICAgIHNpZGU1OiBEaXNoO1xuICAgIGRlc3NlcnQxOiBEaXNoO1xuICAgIGRlc3NlcnQyOiBEaXNoO1xuICAgIGRlc3NlcnQzOiBEaXNoO1xuICAgIGRlc3NlcnQ0OiBEaXNoO1xuXG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgfVxuICAgIFxuICAgIGxvYWQoZGF0ZSkge1xuICAgICAgICByZXR1cm4gZmV0Y2goQ29uZmlnLmFwaVVybCArIFwibWVudS5hc2h4P2Q9XCIgKyBkYXRlKVxuICAgICAgICAgICAgLnRoZW4oaGFuZGxlRXJyb3JzKVxuICAgICAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7XG4gICAgICAgICAgICB9KS50aGVuKGRhdGEgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlRGF0YShkYXRhKTtcblxuICAgICAgICAgICAgICAgIC8vIEFkZCB0byBsb2NhbCBkYlxuICAgICAgICAgICAgICAgIGxldCBkYXRhYmFzZSA9IG5ldyBjb3VjaGJhc2UuQ291Y2hiYXNlKFwid3NtXCIpO1xuICAgICAgICAgICAgICAgIGxldCBtZW51ID0gZGF0YWJhc2UuZ2V0RG9jdW1lbnQoZGF0ZSk7XG4gICAgICAgICAgICAgICAgaWYgKCFtZW51KSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGFiYXNlLmNyZWF0ZURvY3VtZW50KGRhdGEsIGRhdGUpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGFiYXNlLnVwZGF0ZURvY3VtZW50KGRhdGUsIGRhdGEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuY2hlY2tEYXRhYmFzZShkYXRlLCBlcnJvcik7XG4gICAgICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGNoZWNrRGF0YWJhc2UoZGF0ZTogc3RyaW5nLCBlcnJvcikgeyAgICAgICBcbiAgICAgICAgbGV0IGRhdGFiYXNlOiBjb3VjaGJhc2UuQ291Y2hiYXNlID0gbmV3IGNvdWNoYmFzZS5Db3VjaGJhc2UoXCJ3c21cIik7XG4gICAgICAgIGxldCBtZW51OiBEYXlNZW51ID0gZGF0YWJhc2UuZ2V0RG9jdW1lbnQoZGF0ZSk7XG4gICAgICAgIGlmICghbWVudSkge1xuICAgICAgICAgICAgdGhyb3cgRXJyb3IoZXJyb3IpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVEYXRhKG1lbnUpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBoYW5kbGVEYXRhKGRhdGEpIHtcbiAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0KFwibWVudURhdGVcIiwgZGF0YS5NZW51RGF0ZSk7XG4gICAgICAgICAgICB0aGlzLnNldChcImNhbGVuZGFySWRcIiwgZGF0YS5DYWxlbmRhcklEKTtcbiAgICAgICAgICAgIHRoaXMuc2V0KFwibWFpbjFcIiwgdGhpcy5tYWtlRGlzaChkYXRhLk1haW4xLCBkYXRhLkNhbGVuZGFySUQsIGRhdGEuTWVudURhdGUsIFwibm9faW1hZ2VfYnJvY2NvbGkuanBnXCIpKTtcbiAgICAgICAgICAgIHRoaXMuc2V0KFwibWFpbjJcIiwgdGhpcy5tYWtlRGlzaChkYXRhLk1haW4yLCBkYXRhLkNhbGVuZGFySUQsIGRhdGEuTWVudURhdGUsIFwibm9faW1hZ2VfbGVlay5qcGdcIikpO1xuICAgICAgICAgICAgdGhpcy5zZXQoXCJzaWRlMVwiLCB0aGlzLm1ha2VEaXNoKGRhdGEuU2lkZTEsIGRhdGEuQ2FsZW5kYXJJRCwgZGF0YS5NZW51RGF0ZSwgXCJub19pbWFnZV9jYXJyb3QuanBnXCIpKTtcbiAgICAgICAgICAgIHRoaXMuc2V0KFwic2lkZTJcIiwgdGhpcy5tYWtlRGlzaChkYXRhLlNpZGUyLCBkYXRhLkNhbGVuZGFySUQsIGRhdGEuTWVudURhdGUsIFwibm9faW1hZ2VfcHVtcGtpbi5qcGdcIikpO1xuICAgICAgICAgICAgdGhpcy5zZXQoXCJzaWRlM1wiLCB0aGlzLm1ha2VEaXNoKGRhdGEuU2lkZTMsIGRhdGEuQ2FsZW5kYXJJRCwgZGF0YS5NZW51RGF0ZSwgXCJub19pbWFnZV9icm9jY29saS5qcGdcIikpO1xuICAgICAgICAgICAgdGhpcy5zZXQoXCJzaWRlNFwiLCB0aGlzLm1ha2VEaXNoKGRhdGEuU2lkZTQsIGRhdGEuQ2FsZW5kYXJJRCwgZGF0YS5NZW51RGF0ZSwgXCJub19pbWFnZV9sZWVrLmpwZ1wiKSk7XG4gICAgICAgICAgICB0aGlzLnNldChcInNpZGU1XCIsIHRoaXMubWFrZURpc2goZGF0YS5TaWRlNSwgZGF0YS5DYWxlbmRhcklELCBkYXRhLk1lbnVEYXRlLCBcIm5vX2ltYWdlX2NhcnJvdC5qcGdcIikpO1xuICAgICAgICAgICAgdGhpcy5zZXQoXCJkZXNzZXJ0MVwiLCB0aGlzLm1ha2VEaXNoKGRhdGEuRGVzc2VydDEsIGRhdGEuQ2FsZW5kYXJJRCwgZGF0YS5NZW51RGF0ZSwgXCJub19pbWFnZV9zdHJhd2JlcnJ5LmpwZ1wiKSk7XG4gICAgICAgICAgICB0aGlzLnNldChcImRlc3NlcnQyXCIsIHRoaXMubWFrZURpc2goZGF0YS5EZXNzZXJ0MiwgZGF0YS5DYWxlbmRhcklELCBkYXRhLk1lbnVEYXRlLCBcIm5vX2ltYWdlX3B1bXBraW4uanBnXCIpKTtcbiAgICAgICAgICAgIHRoaXMuc2V0KFwiZGVzc2VydDNcIiwgdGhpcy5tYWtlRGlzaChkYXRhLkRlc3NlcnQzLCBkYXRhLkNhbGVuZGFySUQsIGRhdGEuTWVudURhdGUsIFwibm9faW1hZ2Vfc3RyYXdiZXJyeS5qcGdcIikpO1xuICAgICAgICAgICAgdGhpcy5zZXQoXCJkZXNzZXJ0NFwiLCB0aGlzLm1ha2VEaXNoKGRhdGEuRGVzc2VydDQsIGRhdGEuQ2FsZW5kYXJJRCwgZGF0YS5NZW51RGF0ZSwgXCJub19pbWFnZV9wdW1wa2luLmpwZ1wiKSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIG1ha2VEaXNoKGpzb25PYmosIGNhbGVuZGFySWQsIG1lbnVEYXRlLCBub0ltZ1BhdGg6IHN0cmluZyk6IERpc2gge1xuICAgICAgICBpZiAoanNvbk9iaikgeyAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIFNldHVwIGRpc2ggb2JqZWN0XG4gICAgICAgICAgICBsZXQgZGlzaDogRGlzaCA9IHtcbiAgICAgICAgICAgICAgICBpZDoganNvbk9iai5EaXNoSUQsXG4gICAgICAgICAgICAgICAgY2FsZW5kYXJJZDogY2FsZW5kYXJJZCxcbiAgICAgICAgICAgICAgICBtZW51RGF0ZTogbWVudURhdGUsXG4gICAgICAgICAgICAgICAgbmFtZToganNvbk9iai5OYW1lLFxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBqc29uT2JqLkRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uX2h0bWw6IGA8L3N0eWxlPjxkaXYgc3R5bGU9XCJmb250LWZhbWlseTogQXJpYWwsIEhlbHZldGljYSwgc2Fucy1zZXJpZjtcIj4ke2pzb25PYmouRGVzY3JpcHRpb25IVE1MfTwvZGl2PmAsXG4gICAgICAgICAgICAgICAgdmVnZXRhcmlhbjoganNvbk9iai5WZWdldGFyaWFuLFxuICAgICAgICAgICAgICAgIGluZ3JlZGllbnRzOiBbXSxcbiAgICAgICAgICAgICAgICBhbGxlcmdlbnM6IFtdLFxuICAgICAgICAgICAgICAgIGhhc1lvdXJBbGxlcmdlbnM6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHlvdXJBbGxlcmdlbkNvdW50OiAwLFxuICAgICAgICAgICAgICAgIHlvdXJBbGxlcmdlbk1lc3NhZ2U6IFwiXCIsXG4gICAgICAgICAgICAgICAgaGFzR2FsbGVyeTogZmFsc2UsXG4gICAgICAgICAgICAgICAgcGhvdG9zOiBbXVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLy8gSW5ncmVkaWVudHNcbiAgICAgICAgICAgIGxldCBpbmdyZWRpZW50U3RyOiBzdHJpbmdbXSA9IFtdO1xuICAgICAgICAgICAganNvbk9iai5JbmdyZWRpZW50cy5mb3JFYWNoKGluZ3JlZGllbnQgPT4ge1xuICAgICAgICAgICAgICAgIGxldCBpbmc6IEluZ3JlZGllbnQgPSB7XG4gICAgICAgICAgICAgICAgICAgIGlkOiBpbmdyZWRpZW50LkluZ3JlZGllbnRJRCxcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogaW5ncmVkaWVudC5JbmdyZWRpZW50LFxuICAgICAgICAgICAgICAgICAgICB2ZWdldGFyaWFuOiBpbmdyZWRpZW50LlZlZ2V0YXJpYW4sXG4gICAgICAgICAgICAgICAgICAgIG1lYXN1cmVtZW50SWQ6IGluZ3JlZGllbnQuTWVhc3VyZW1lbnRJRCxcbiAgICAgICAgICAgICAgICAgICAgaGVhZGluZzogaW5ncmVkaWVudC5IZWFkaW5nLFxuICAgICAgICAgICAgICAgICAgICBhbGxlcmdlbnM6IFtdLFxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGxldCBhbGxlcmdlbnNTdHI6IHN0cmluZ1tdID0gW107XG4gICAgICAgICAgICAgICAgaWYgKGluZ3JlZGllbnQuQWxsZXJnZW5zKSB7IFxuICAgICAgICAgICAgICAgICAgICBpbmdyZWRpZW50LkFsbGVyZ2Vucy5mb3JFYWNoKGFsbGVyZ2VuID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghYWxsZXJnZW4uRGVsZXRlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZy5hbGxlcmdlbnMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBhbGxlcmdlbi5BbGxlcmdlbklELFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBhbGxlcmdlbi5BbGxlcmdlblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxsZXJnZW5zU3RyLnB1c2goYWxsZXJnZW4uQWxsZXJnZW4pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoIWluZ3JlZGllbnQuSGVhZGluZykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoYWxsZXJnZW5zU3RyLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGluZ3JlZGllbnRTdHIucHVzaChpbmdyZWRpZW50LkluZ3JlZGllbnQgKyBcIiAoXCIgKyBhbGxlcmdlbnNTdHIudG9TdHJpbmcoKSArIFwiKVwiKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGluZ3JlZGllbnRTdHIucHVzaChpbmdyZWRpZW50LkluZ3JlZGllbnQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGRpc2guaW5ncmVkaWVudHMucHVzaChpbmcpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBkaXNoLmluZ3JlZGllbnRMaXN0ID0gaW5ncmVkaWVudFN0ci5qb2luKCcsICcpO1xuXG4gICAgICAgICAgICAvLyBBbGxlcmdlbnNcbiAgICAgICAgICAgIGxldCBhbGxlcmdlbnNTdHI6IHN0cmluZ1tdID0gW107XG4gICAgICAgICAgICBsZXQgeW91ckFsbGVyZ2Vuc1N0cjogc3RyaW5nW10gPSBbXTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAganNvbk9iai5BbGxlcmdlbnMuZm9yRWFjaChhbGxlcmdlbiA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKCFhbGxlcmdlbi5EZWxldGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGRpc2guYWxsZXJnZW5zLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGFsbGVyZ2VuLkFsbGVyZ2VuSUQsXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBhbGxlcmdlbi5BbGxlcmdlblxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICBhbGxlcmdlbnNTdHIucHVzaChhbGxlcmdlbi5BbGxlcmdlbik7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGFsbGVyZ2VuTGlzdC5teUFsbGVyZ2Vucy5pbmNsdWRlcyhhbGxlcmdlbi5BbGxlcmdlbklEKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgeW91ckFsbGVyZ2Vuc1N0ci5wdXNoKGFsbGVyZ2VuLkFsbGVyZ2VuKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBkaXNoLmFsbGVyZ2VuTGlzdCA9IGFsbGVyZ2Vuc1N0ci5qb2luKCcsICcpO1xuXG4gICAgICAgICAgICAvLyBIYXMgeW91ciBhbGxlcmdlbnM/XG4gICAgICAgICAgICBpZiAoeW91ckFsbGVyZ2Vuc1N0ci5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgZGlzaC55b3VyQWxsZXJnZW5zID0geW91ckFsbGVyZ2Vuc1N0ci5qb2luKCcsICcpO1xuICAgICAgICAgICAgICAgIGRpc2guaGFzWW91ckFsbGVyZ2VucyA9IHRydWU7XG4gICAgICAgICAgICAgICAgZGlzaC55b3VyQWxsZXJnZW5Db3VudCA9IHlvdXJBbGxlcmdlbnNTdHIubGVuZ3RoO1xuICAgICAgICAgICAgICAgIGRpc2gueW91ckFsbGVyZ2VuTWVzc2FnZSA9ICBgJHtkaXNoLm5hbWV9IGNvbnRhaW5zICR7ZGlzaC55b3VyQWxsZXJnZW5Db3VudH0gb2YgeW91ciBhbGxlcmdlbnNgXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFBob3Rvc1xuICAgICAgICAgICAganNvbk9iai5QaG90b3MuZm9yRWFjaCgocGhvdG8sIGluZGV4KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGluZGV4ID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgZGlzaC5waG90byA9IHBob3RvLlVSTDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZGlzaC5waG90b3MucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIHVybDogcGhvdG8uVVJMLFxuICAgICAgICAgICAgICAgICAgICBjYXB0aW9uOiBwaG90by5DYXB0aW9uXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmICghZGlzaC5waG90bykge1xuICAgICAgICAgICAgICAgIC8vZGlzaC5waG90byA9IFwifi9pbWFnZXMvXCIgKyBDb25maWcubm9JbWFnZVBhdGhzW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIENvbmZpZy5ub0ltYWdlUGF0aHMubGVuZ3RoKV07XG4gICAgICAgICAgICAgICAgZGlzaC5waG90byA9IFwifi9pbWFnZXMvXCIgKyBub0ltZ1BhdGg7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZGlzaC5waG90b3MubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgICAgIGRpc2guaGFzR2FsbGVyeSA9IHRydWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFJldHVybiB0aGUgZGlzaFxuICAgICAgICAgICAgcmV0dXJuIGRpc2g7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGlkOiAwLFxuICAgICAgICAgICAgICAgIGNhbGVuZGFySWQ6IDAsXG4gICAgICAgICAgICAgICAgbWVudURhdGU6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICAgICAgbmFtZTogJycsXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICcnLFxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uX2h0bWw6ICcnLFxuICAgICAgICAgICAgICAgIHZlZ2V0YXJpYW46IGZhbHNlLFxuICAgICAgICAgICAgICAgIGhhc1lvdXJBbGxlcmdlbnM6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHlvdXJBbGxlcmdlbkNvdW50OiAwLFxuICAgICAgICAgICAgICAgIHlvdXJBbGxlcmdlbk1lc3NhZ2U6IFwiXCIsXG4gICAgICAgICAgICAgICAgcGhvdG86IFwiXCJcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmZ1bmN0aW9uIGhhbmRsZUVycm9ycyhyZXNwb25zZSkge1xuICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgICAgdGhyb3cgRXJyb3IocmVzcG9uc2Uuc3RhdHVzKTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3BvbnNlO1xufSJdfQ==